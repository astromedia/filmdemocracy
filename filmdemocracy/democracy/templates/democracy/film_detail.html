{% extends "democracy/film_base.html" %}
{% load static %}
{% load widget_tweaks %}
{% load i18n %}

{% block title %}{% trans 'Film details' %}{% endblock %}

{% block content %}


<!--START: SEEN DATE (FILM SEEN)-->
{% if film.seen %}

<div class="alert alert-success text-center">
  <strong>{% trans 'Seen in session on the:' %} {{ film.seen_date}}</strong>
</div>

{% endif %}
<!--END: SEEN DATE (FILM SEEN)-->


<div class="text-center mt-4"><a href="{% url 'democracy:candidate_films' club.id %}">
  {% trans 'Go back to candidate films' %}</a>
</div>


<!--START: VOTES (FILM NOT SEEN)-->
{% if not film.seen %}

<h4 class="text-center h4 my-4">{% trans 'Did you vote already?' %}</h4>

{% for choice, choice_dict in vote_choices.items %}
<div class="text-center">
  <form action="{% url 'democracy:vote_film' club.id film.id %}" method="post">
    {% csrf_token %}

    <!--POSITIVE BUTTON-->
    {% if choice_dict.choice_karma == 'positive' %}
    {% if choice_dict.choice_voted %}
    <label class="btn btn-success btn-block vote-btn" for="vote_{{ forloop.counter }}">
      {{ choice_dict.choice_text }}
    </label>
    {% else %}
    <label class="btn btn-outline-success btn-block vote-btn success-bg black" for="vote_{{ forloop.counter }}">
      {{ choice_dict.choice_text }}
    </label>
    {% endif %}

    <!--NEUTRAL BUTTON-->
    {% elif choice_dict.choice_karma == 'neutral' %}
    {% if choice_dict.choice_voted %}
    <label class="btn btn-secondary btn-block vote-btn" for="vote_{{ forloop.counter }}">
      {{ choice_dict.choice_text }}
    </label>
    {% else %}
    <label class="btn btn-outline-secondary btn-block vote-btn secondary-bg black" for="vote_{{ forloop.counter }}">
      {{ choice_dict.choice_text }}
    </label>
    {% endif %}

    <!--NEGATIVE BUTTON-->
    {% elif choice_dict.choice_karma == 'negative' %}
    {% if choice_dict.choice_voted %}
    <label class="btn btn-danger btn-block vote-btn" for="vote_{{ forloop.counter }}">
      {{ choice_dict.choice_text }}
    </label>
    {% else %}
    <label class="btn btn-outline-danger btn-block vote-btn danger-bg black" for="vote_{{ forloop.counter }}">
      {{ choice_dict.choice_text }}
    </label>
    {% endif %}
    {% endif %}

    <input type="submit" class="btn btn-block vote-btn invisible" name="choice"
           id="vote_{{ forloop.counter }}" value="{{ choice_dict.choice }}">

  </form>
</div>
{% endfor %}

{% endif %}
<!--END: VOTES (FILM NOT SEEN)-->


<!--START: SEEN BY (FILM NOT SEEN)-->
{% if film.seen %}
<div class="mt-4 h6 text-center">
  <p>{% trans 'Seen by:' %}</p>
</div>

<div class="container-fluid">

  <div class="row mt-4 justify-content-center">

    {% for member in film.seen_by.all %}

    <div class="col-auto">
      <div class="card mb-4 shadow-sm" style="width: 8rem;">

        <a href="{% url 'socialclub:club_member_detail' club.id member.id %}">
          {% if member.profile_image %}
          <img class="card-img-top border border-secondary member-shadow"
               src="{{ member.profile_image.url }}"
               alt="member.profile_image not found">
          {% else %}
          <img class="card-img-top border border-secondary member-shadow"
               src="{% static 'registration/user_no_profile_image.png' %}"
               alt="member.profile_image not found">
          {% endif %}
        </a>

        <div class="text-center p-1" style="color: black">{{ member.username }}</div>

      </div>
    </div>

    {% endfor %}

  </div>
</div>

{% endif %}
<!--END: SEEN BY (FILM NOT SEEN)-->


<!--START: REGISTERED VOTES-->
<div class="registered-votes">
  <h5 class="text-center mt-5 mb-2 font-weight-normal">
    Registered votes on film:
  </h5>
<hr class="text-center mt-n1 mb-3">
</div>

{% if film.vote_set.all %}


{% for vote in film.vote_set.all %}
<div class="row justify-content-center mb-5">
  <div class="col-6 text-right">
    <a href="{% url 'socialclub:club_member_detail' club.id vote.user.id %}" style="color: black;">
      <strong>{{ vote.user.username }}:</strong>
    </a>
  </div>
  <div class="col-6">

    {% if vote.vote_karma == 'positive' %}
    <p class="text-success">{{ vote.get_choice_display }}</p>
    {% elif vote.vote_karma == 'neutral' %}
    <p class="text-secondary">{{ vote.get_choice_display }}</p>
    {% elif vote.vote_karma == 'negative' %}
    <p class="text-danger">
      {% if vote.choice == "veto" %}
      <strong>{{ vote.get_choice_display }}</strong>
      {% else %}
      {{ vote.get_choice_display }}
    </p>
    {% endif %}
    {% endif %}
  </div>
</div>
{% endfor %}


{% else %}


<div class="text-center mt-n3">
  {% trans 'No one has voted this film yet!' %}
</div>


{% endif %}
<!--END: REGISTERED VOTES-->


<!--START: FILM OPTIONS-->
{% if not film.seen %}
<div class="text-center">
  <button type="button" class="btn btn-sm btn-outline-danger my-3" data-toggle="modal"
          data-target="#DeleteModalCenter">
    {% trans 'Remove from candidate films' %}
  </button>
</div>
{% else %}
<div class="text-center">
  <button type="button" class="btn btn-sm btn-outline-dark my-3" data-toggle="modal"
          data-target="#MoveBackModalCenter">
    {% trans 'Move back to list of candidate films' %}
  </button>
</div>
{% endif %}
<!--END: FILM OPTIONS-->


<!--START: MODAL DELETE-->
<div class="modal fade" id="DeleteModalCenter" tabindex="-1" role="dialog" aria-labelledby="DeleteModalCenterTitle"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="DeleteModalCenterTitle">{% trans 'Remove from candidate films' %}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {% trans 'Are you sure you want to remove this film from the list?' %}<br>
        {% trans 'All its recorded votes will be lost...' %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn btn-secondary" data-dismiss="modal">
          {% trans 'Cancel' %}
        </button>
        <form action="{% url 'democracy:delete_film' club.id film.id %}" class="text-center">
          {% csrf_token %}
          <button method="post" type="submit" class="btn btn-outline-danger mr-3">
            {% trans 'Confirm' %}
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
<!--END: MODAL DELETE-->


<!--START: MODAL MOVE BACK-->
<div class="modal fade" id="MoveBackModalCenter" tabindex="-1" role="dialog" aria-labelledby="MoveBackModalCenterTitle"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="MoveBackModalCenterTitle">{% trans 'Move back to list of candidate films' %}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {% trans 'Are you sure you want to move it back to candidate films?' %}<br>
        {% trans 'The info of when and who saw it will be lost...' %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn btn-secondary" data-dismiss="modal">
          {% trans 'Cancel' %}
        </button>
        <form action="{% url 'democracy:unsee_film' club.id film.id %}" class="text-center">
          {% csrf_token %}
          <button method="post" type="submit" class="btn btn-outline-dark mr-3">
            {% trans 'Confirm' %}
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
<!--END: MODAL MOVE BACK-->


{% endblock %}