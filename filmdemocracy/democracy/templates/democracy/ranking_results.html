{% extends "democracy/base_club_banner.html" %}
{% load static %}
{% load static %}
{% load widget_tweaks %}
{% load i18n %}

{% block styles %}
{% load static %}
<link rel="stylesheet" href="{% static 'democracy/css/base_club_banner.css' %}">
<link rel="stylesheet" href="{% static 'democracy/css/ranking_results.css' %}">
{% endblock %}

{% block title %}{% trans 'Voting results' %}{% endblock %}

{% block content %}


<div class="page-title">
  <span>{% trans 'Film ranking' %}</span>
</div>


<p class="text-center mt-4 mb-1">
  <strong>{% trans 'Attending club members:' %}</strong>
</p>

<!--START: PARTICIPANTS-->
<div class="participants-header border-top border-bottom">

  <div class="row mx-1 justify-content-center">
    {% for participant in participants %}
    <div class="col col-auto">
      {% if participant.profile_image %}
      <img class="participant-picture my-2 border border-secondary rounded-circle" title="{{ participant.username }}"
           src="{{ participant.profile_image.url }}"
           alt="participant.profile_image not found">
      {% else %}
      <img class="participant-picture my-2 border border-secondary rounded-circle" title="{{ participant.username }}"
           src="{% static 'registration/svg/user_no_profile_image.svg' %}" alt="participant.profile_image not found">
      {% endif %}
    </div>
    {% endfor %}
  </div>
</div>
<!--END: PARTICIPANTS-->


<p class="text-center mt-3 mb-n1">
  <strong>{% trans 'Ranked films:' %}</strong>
</p>


<!--START: VOTING RESULTS-->
{% for film_results in ranking_results|dictsortreversed:"points" %}
<div class="film-result pointer-cursor" data-toggle="modal" data-target="#FilmResultsModal_{{ forloop.counter }}">

  <div class="media">

    <div class="align-self-center film-poster text-center">
      <img class="" src="{{ film_results.film.db.poster_url }}">
    </div>

    <div class="media-body align-self-center">

      <div class="film-title">{{ film_results.film.db.title }}<span class="text-secondary">({{ film_results.duration }} min)</span></div>

      <div class="row align-items-center">

        <div class="col col-4">
          <div class="progress" style="height: 0.6rem;">
            {% if film_results.points > 50 %}
              <div class="progress-bar bg-success" role="progressbar" style="width: {{ film_results.points }}%"></div>
            {% elif film_results.points == 50 %}
              <div class="progress-bar bg-warning" role="progressbar" style="width: {{ film_results.points }}%"></div>
            {% elif film_results.points < 50 %}
              <div class="progress-bar bg-danger" role="progressbar" style="width: {{ film_results.points }}%"></div>
            {% endif %}
          </div>
        </div>

        <div class="col col-8">
          <div class='results-box'>
            <div class="row justify-content-start">

              {% if film_results.positive_votes|length > 0 %}
              <div class="col col-2">
                <div class="media">
                  <strong>{{ film_results.positive_votes|length }}</strong>
                  <img class="result-icon result-icon-rounded align-self-center" src="{% static 'democracy/svg/thumbsupwhite.svg'%}">
                </div>
              </div>
              {% endif %}

              {% if film_results.neutral_votes|length > 0 %}
              <div class="col col-2">
                <div class="media">
                  <strong>{{ film_results.neutral_votes|length }}</strong>
                  <img class="result-icon result-icon-rounded align-self-center" src="{% static 'democracy/svg/thumbsneutralwhite.svg'%}">
                </div>
              </div>
              {% endif %}

              {% if film_results.negative_votes|length > 0 %}
              <div class="col col-2">
                <div class="media">
                  <strong>{{ film_results.negative_votes|length }}</strong>
                  <img class="result-icon result-icon-rounded align-self-center" src="{% static 'democracy/svg/thumbsdownwhite.svg'%}">
                </div>
              </div>
              {% endif %}

              {% if film_results.abstentionists|length > 0 %}
              <div class="col col-2">
                <div class="media">
                  <strong>{{ film_results.abstentionists|length }}</strong>
                  <img class="result-icon result-icon-rounded align-self-center" src="{% static 'democracy/svg/question.svg'%}">
                </div>
              </div>
              {% endif %}

              {% if film_results.warnings %}
              <div class="col col-2">
                <div class="media">
                  <strong>{{ film_results.warnings|length }}</strong>
                  <img class="result-icon align-self-center" src="{% static 'democracy/svg/alert.svg'%}">
                </div>
              </div>
              {% endif %}

            </div>
          </div>
        </div>

      </div>

    </div>

  </div>

</div>
{% endfor %}
<!--END: VOTING RESULTS-->


<!--LINK TO NEW RANKING-->
<div class="text-center my-5">
    <a class="" href="{% url 'democracy:ranking_generator' club.id %}">
    {% trans 'Generate new ranking' %}
    </a>
</div>

<div class="text-center strong-link my-5">
  <a class="" href="{% url 'democracy:club_detail' club.id %}">{% trans 'Go back to club' %}</a>
</div>


{% for film_results in ranking_results|dictsortreversed:"points" %}
<!--START: RESULTS MODAL-->
<div class="modal fade" id="FilmResultsModal_{{ forloop.counter }}" tabindex="-1" role="dialog"
     aria-labelledby="FilmResultsModal_{{ forloop.counter }}_Title" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">

      <div class="modal-header modal-results-header">
        <h5 class="modal-title" id="FilmResultsModal_{{ forloop.counter }}_Title">{{ film_results.film.db.title }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body modal-results">


        <!--START SCORE-->
        <div class="mt-1 mb-3 row align-items-center">
          <div class="col-auto pr-2">
            <strong>{% trans 'Score:' %}</strong>
          </div>
          <div class="col pl-2">
            <div class="progress">
              {% if film_results.points > 50 %}
                <div class="progress-bar bg-success" role="progressbar" style="width: {{ film_results.points }}%">{{ film_results.points }}/100</div>
              {% elif film_results.points == 50 %}
                <div class="progress-bar bg-warning" role="progressbar" style="width: {{ film_results.points }}%">{{ film_results.points }}/100</div>
              {% elif film_results.points < 50 %}
                <div class="progress-bar bg-danger" role="progressbar" style="width: {{ film_results.points }}%">{{ film_results.points }}/100</div>
              {% endif %}
            </div>
          </div>
        </div>
        <!--END SCORE-->

        <!--START VOTES-->
        {% if film_results.positive_votes or film_results.neutral_votes or film_results.negative_votes %}

        <!--START POSITIVE VOTES-->
        {% for vote in film_results.positive_votes|dictsortreversed:"vote_score" %}

        <div class="media vote">
          {% if vote.user.profile_image %}
          <img class="user-image rounded-circle" title="{{ vote.user.username }}" src="{{ vote.user.profile_image.url }}">
          {% else %}
          <img class="user-image rounded-circle" title="{{ vote.user.username }}" src="{% static 'registration/svg/user_no_profile_image.svg' %}">
          {% endif %}
          <img class="vote-icon rounded-circle" src="{% static 'democracy/svg/thumbsupwhite.svg'%}">
          <div class="vote-text">
            <a class="strong-link" href="{% url 'democracy:club_member_detail' club.id vote.user.id %}">
              {{ vote.user.username }}</a>:
            <span>{{ vote.get_choice_display }}</span>
          </div>
        </div>

        {% endfor %}
        <!--END POSITIVE VOTES-->

        <!--START NEUTRAL VOTES-->
        {% for vote in film_results.neutral_votes|dictsortreversed:"vote_score" %}

        <div class="media vote">
          {% if vote.user.profile_image %}
          <img class="user-image rounded-circle" title="{{ vote.user.username }}" src="{{ vote.user.profile_image.url }}">
          {% else %}
          <img class="user-image rounded-circle" title="{{ vote.user.username }}" src="{% static 'registration/svg/user_no_profile_image.svg' %}">
          {% endif %}
          <img class="vote-icon rounded-circle" src="{% static 'democracy/svg/thumbsneutralwhite.svg'%}">
          <div class="vote-text">
            <a class="strong-link" href="{% url 'democracy:club_member_detail' club.id vote.user.id %}">
              {{ vote.user.username }}</a>:
            <span>{{ vote.get_choice_display }}</span>
          </div>
        </div>

        {% endfor %}
        <!--END NEUTRAL VOTES-->

        <!--START NEGATIVE VOTES-->
        {% for vote in film_results.negative_votes|dictsortreversed:"vote_score" %}

        <div class="media vote">
          {% if vote.user.profile_image %}
          <img class="user-image rounded-circle" title="{{ vote.user.username }}" src="{{ vote.user.profile_image.url }}">
          {% else %}
          <img class="user-image rounded-circle" title="{{ vote.user.username }}" src="{% static 'registration/svg/user_no_profile_image.svg' %}">
          {% endif %}
          <img class="vote-icon rounded-circle" src="{% static 'democracy/svg/thumbsdownwhite.svg'%}">
          <div class="vote-text">
            <a class="strong-link" href="{% url 'democracy:club_member_detail' club.id vote.user.id %}">
              {{ vote.user.username }}</a>:
            <span>{{ vote.get_choice_display }}</span>
          </div>
        </div>

        {% endfor %}
        <!--END NEGATIVE VOTES-->

        {% endif %}
        <!--END VOTES-->


        <!--START ABSTENTIONISTS-->
        {% if film_results.abstentionists %}

        <div class="row vote mt-3">
          {% for participant in film_results.abstentionists %}
          <div class="col col-auto media">
            {% if participant.profile_image %}
            <img class="user-image rounded-circle" title="{{ participant.username }}"
                 src="{{ participant.profile_image.url }}" alt="participant.profile_image not found">
            {% else %}
            <img class="user-image rounded-circle" title="{{ participant.username }}"
                 src="{% static 'registration/svg/user_no_profile_image.svg' %}"
                 alt="participant.profile_image not found">
            {% endif %}
            <img class="vote-icon rounded-circle" src="{% static 'democracy/svg/question.svg'%}">
          </div>
          {% endfor %}
        </div>

        {% endif %}
        <!--END ABSTENTIONISTS-->

        
        <!--START WARNING-->
        {% if film_results.warnings %}

        <div class="mt-3 mb-2">
          <strong>{% trans 'Warnings:' %}</strong>
        </div>

        <ul>
        {% for warning in film_results.warnings %}
          <li>

            {% if warning.type == 'veto' %}

              {% blocktrans with user=warning.voter film=warning.film %}
              <strong>{{ user }}</strong> vetoed this film.
              {% endblocktrans %}

            {% elif warning.type == 'omg' %}

              {% blocktrans with user=warning.voter film=warning.film %}
              <strong>{{ user }}</strong> really really wants to see this film.
              {% endblocktrans %}

            {% elif warning.type == 'proposer missing' %}

              {% blocktrans with user=warning.voter film=warning.film %}
              <strong>{{ user }}</strong> proposed this film, and is not present.
              {% endblocktrans %}

            {% endif %}

          </li>
        {% endfor %}
        </ul>

        {% endif %}
        <!--END WARNING-->


        <div class="mt-4 mb-3 text-center">
          <a class="strong-link" href="{% url 'democracy:film_detail' club.id film_results.film.public_id film_results.film.db.slug %}">
            {% trans 'Go to film detail' %}
          </a>
        </div>

        
      </div>

    </div>
  </div>
</div>
<!-- END: RESULTS MODAL-->
{% endfor %}


<!--START: BACK TO TOP-->
<a class="pointer-cursor rounded-circle" id="btn-back-to-top" onclick="topFunction()" role="button" title="Go to top" >
  <img class="" src="{% static 'democracy/svg/back_to_top.svg'%}">
</a>
<!--START: BACK TO TOP-->


{% endblock %}